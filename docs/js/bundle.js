
var Cart;Cart={attrs:{buttons:'.product__btn',quantity:'.cart__quantity',currency:'Р'},quantity:0,init:function(){console.log('Cart initialize');Cart.initWidget();Cart.loadProducts();Cart.refreshWidget();$(document).on('click',Cart.attrs.buttons,function(e){console.log('product__btn click');var $product_order=$(this).closest('.product__order');var product_data=$product_order.data();console.log('product_data: ');console.log(product_data);if(product_data!=undefined&&product_data){$(this).addClass('product__btn--hide');$(this).siblings('.product__spinner').addClass('product__spinner--active');Cart.addProduct(product_data);}});$(document).on('change','.spinner__input',function(e){var $product_order=$(this).closest('.product__order');var val=$(this).val();$product_order.data('quantity',val);Cart.updateProduct($product_order.data());});},addProduct:function(product_data){console.log('addProduct: '+product_data.product);var product_id=product_data.product;var cart_data=Cart.getStorage()||{};if(cart_data.hasOwnProperty(product_id)){cart_data[product_id].quantity++;}else{product_data.quantity=1;cart_data[product_id]=product_data;}
Cart.setStorage(cart_data);return false;},deleteProduct:function(product_id){var cart_data=Cart.getStorage();delete cart_data[product_id];Cart.setStorage(product_id);Cart.refreshWidget();return false;},updateProduct:function(product_data){var product_id=product_data.product;var quantity=1;cart_data=Cart.getStorage();cart_data[product_id].quantity=product_data.quantity;if(cart_data[product_id].quantity<1){cart_data[product_id].quantity=1;}
Cart.setStorage(cart_data);Cart.refresh();return false;},refresh:function(){},initWidget:function(){console.log('widget.init');var $wrapper=$('.wrapper');Cart.$widget=$('<div/>',{appendTo:$wrapper,class:'cart-widget',html:'Корзина'});},refreshWidget:function(){console.log('widget.refresh');if(Cart.totals>0){Cart.$widget.addClass('cart-widget--active');Cart.$widget.html(Cart.totals+' товара');}},loadProducts:function(){var cart_data=Cart.getStorage();var totals=0;if(cart_data!==null&&Object.keys(cart_data).length){for(var key in cart_data){if(cart_data.hasOwnProperty(key)){totals+=parseInt(cart_data[key].quantity);Cart.bindProduct(cart_data[key]);}}}
console.log('totals: '+totals)
Cart.totals=totals;},bindProduct:function(product_data){var $product_order=$('.product__order[data-product="'+product_data.product+'"]')
$product_order.data('quantity',product_data.quantity);$product_order.find('.product__btn').addClass('product__btn--hide');$product_order.find('.product__spinner').addClass('product__spinner--active');$product_order.find('.spinner__input').val(product_data.quantity);$product_order.find('.spinner__placeholder').html(product_data.quantity);},setStorage:function(o){localStorage.setItem('pxcart',JSON.stringify(o));return false;},getStorage:function(){return JSON.parse(localStorage.getItem('pxcart'));}};$(function(){console.log('init');Cart.init();var slideoutBtn=document.querySelector('.navbar-toggler');var slideout=new Slideout({'panel':document.getElementById('panel'),'menu':document.getElementById('navbar'),'padding':250,'tolerance':70,'side':'right','tolerance':70,'touch':false});slideoutBtn.addEventListener('click',function(){slideout.toggle();});$('.scroll-to-target').click(function(e){console.log('scroll-to-target');var target=$(this).attr('href');var offset=100;if($(this).data('offset')!=undefined)offset=$(this).data('offset');$('.nav').removeClass('nav--active');$.scrollTo(target,600,{offset:-offset});return false;});$('.gallery').slick({dots:true,slidesPerRow:3,slidesToScroll:1,rows:2,responsive:[{breakpoint:478,settings:{slidesPerRow:1,rows:1,dots:false}}]});$('body').delegate('*[data-event="popup"]','click',function(e){console.log('popup event');var popup=$(this).data('popup');if(popup){$('body').addClass('body--noscroll');$('#'+popup).addClass('popup--active');}
return false;});$('body').delegate('.popup__close','click',function(e){var $popup=$(this).closest('.popup');$('body').removeClass('body--noscroll');$popup.removeClass('popup--active');if($(this).hasClass('popup__close--remove')){$popup.remove();}
return false;});$(document).on('click','.spinner__button',function(e){console.log('.spinner__button');var $spinner=$(this).closest('.spinner');var $target=$spinner.find('.spinner__input');var $placeholder=$spinner.find('.spinner__placeholder');console.log($target);var change=1,min=1,max=200,uom='';if($target.data('change')!=undefined)change=parseInt($target.data('change'));if($target.data('min')!=undefined)min=parseInt($target.data('min'));if($target.data('max')!=undefined)max=parseInt($target.data('max'));if($target.data('uom')!=undefined)uom=$target.data('uom');var val;if($(this).hasClass('spinner__button--up')){val=parseInt($target.val())+change;}else{val=parseInt($target.val())-change;}
if(val<min)val=min;if(val>max)val=max;$target.val(val);$target.trigger('change');$placeholder.html(val+' '+uom);console.log(val+' '+uom);return false;});});